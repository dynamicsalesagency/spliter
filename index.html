<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Email Splitter & Extractor | Professional Tool</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3a0ca3;
      --accent: #f72585;
      --success: #4cc9f0;
      --warning: #f9c74f;
      --danger: #f94144;
      
      --bg-light: #f8f9fa;
      --card-light: #ffffff;
      --text-light: #212529;
      --muted-light: #6c757d;
      --border-light: #dee2e6;
      
      --bg-dark: #121212;
      --card-dark: #1e1e1e;
      --text-dark: #e9ecef;
      --muted-dark: #adb5bd;
      --border-dark: #2d2d2d;
      
      --radius: 12px;
      --radius-sm: 8px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s ease;
    }
    
    /* Light theme as default */
    :root {
      --bg: var(--bg-light);
      --card: var(--card-light);
      --text: var(--text-light);
      --muted: var(--muted-light);
      --border: var(--border-light);
    }
    
    .dark-theme {
      --bg: var(--bg-dark);
      --card: var(--card-dark);
      --text: var(--text-dark);
      --muted: var(--muted-dark);
      --border: var(--border-dark);
    }
    
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body {
      background: var(--bg); 
      color: var(--text);
      font-family: 'Inter', 'Segoe UI', system-ui, Arial, sans-serif;
      line-height: 1.6; 
      min-height: 100vh; 
      display: flex;
      transition: var(--transition);
    }
    
    /* Sidebar Navigation */
    .sidebar {
      width: 280px; 
      background: var(--card); 
      padding: 25px 20px; 
      height: 100vh; 
      position: sticky; 
      top: 0;
      box-shadow: var(--shadow); 
      overflow-y: auto; 
      display: flex; 
      flex-direction: column;
      transition: var(--transition);
      border-right: 1px solid var(--border);
    }
    
    .logo {
      display: flex; 
      align-items: center; 
      gap: 15px; 
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .logo-icon {
      width: 50px; 
      height: 50px; 
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
      display: flex;
      align-items: center; 
      justify-content: center;
      font-size: 24px; 
      color: white;
      box-shadow: var(--shadow);
    }
    
    .logo-text { 
      font-family: 'Poppins', sans-serif;
      font-size: 20px; 
      font-weight: 700; 
      line-height: 1.3; 
      color: var(--text);
    }
    
    .logo-text span { 
      display: block; 
      color: var(--primary);
      font-size: 14px;
      font-weight: 500;
    }
    
    .nav-links {
      list-style: none; 
      margin-top: 20px;
    }
    
    .nav-links li { 
      margin-bottom: 8px; 
    }
    
    .nav-links a {
      display: flex; 
      align-items: center; 
      gap: 12px;
      padding: 12px 15px; 
      border-radius: var(--radius-sm);
      color: var(--muted); 
      text-decoration: none; 
      transition: var(--transition);
      font-weight: 500;
    }
    
    .nav-links a:hover, 
    .nav-links a.active {
      background: rgba(67, 97, 238, 0.1); 
      color: var(--primary);
    }
    
    .nav-links a i { 
      width: 20px; 
      color: var(--muted);
      transition: var(--transition);
    }
    
    .nav-links a:hover i,
    .nav-links a.active i {
      color: var(--primary);
    }
    
    .sidebar-footer {
      margin-top: auto; 
      padding-top: 20px; 
      border-top: 1px solid var(--border);
      color: var(--muted); 
      font-size: 14px; 
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      flex: 1; 
      padding: 30px; 
      overflow-y: auto; 
      transition: var(--transition);
    }
    
    .app-header {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      margin-bottom: 30px; 
      padding-bottom: 20px; 
      border-bottom: 1px solid var(--border);
    }
    
    .header-title { 
      font-family: 'Poppins', sans-serif;
      font-size: 28px; 
      font-weight: 700; 
      color: var(--text);
    }
    
    .header-actions {
      display: flex; 
      align-items: center; 
      gap: 15px;
    }
    
    .theme-toggle {
      background: var(--card); 
      border: 1px solid var(--border); 
      color: var(--text);
      padding: 10px 16px; 
      border-radius: var(--radius); 
      cursor: pointer;
      display: flex; 
      align-items: center; 
      gap: 8px; 
      font-weight: 500;
      transition: var(--transition); 
      box-shadow: var(--shadow);
    }
    
    .theme-toggle:hover { 
      background: var(--primary); 
      color: white;
      border-color: var(--primary);
    }
    
    .user-profile {
      width: 42px; 
      height: 42px; 
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
      display: flex;
      align-items: center; 
      justify-content: center;
      cursor: pointer; 
      box-shadow: var(--shadow);
      color: white;
    }
    
    /* Dashboard Grid */
    .dashboard-grid {
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px; 
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--card); 
      border-radius: var(--radius);
      box-shadow: var(--shadow); 
      padding: 25px; 
      transition: var(--transition);
      display: flex; 
      align-items: center; 
      gap: 20px;
      border: 1px solid var(--border);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .stat-icon {
      width: 60px; 
      height: 60px; 
      border-radius: 15px;
      background: rgba(67, 97, 238, 0.1); 
      display: flex;
      align-items: center; 
      justify-content: center; 
      font-size: 24px;
      color: var(--primary);
    }
    
    .stat-content { 
      flex: 1; 
    }
    
    .stat-value {
      font-size: 28px; 
      font-weight: 700; 
      margin-bottom: 5px;
      color: var(--primary);
    }
    
    .stat-label {
      font-size: 14px; 
      color: var(--muted); 
      font-weight: 500;
    }
    
    .stat-trend {
      font-size: 14px; 
      display: flex; 
      align-items: center; 
      gap: 5px;
      margin-top: 8px;
    }
    
    .trend-up { 
      color: var(--success); 
    }
    
    .trend-down { 
      color: var(--danger); 
    }
    
    /* Main Content Grid */
    .content-grid {
      display: grid; 
      grid-template-columns: 1.2fr 0.8fr; 
      gap: 30px;
    }
    
    @media (max-width: 1200px) {
      .content-grid { 
        grid-template-columns: 1fr; 
      }
    }
    
    .card {
      background: var(--card); 
      border-radius: var(--radius);
      box-shadow: var(--shadow); 
      padding: 30px;
      transition: var(--transition); 
      height: 100%;
      border: 1px solid var(--border);
    }
    
    .card:hover {
      box-shadow: var(--shadow-hover);
    }
    
    .card-header {
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      margin-bottom: 20px; 
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .card-title { 
      font-family: 'Poppins', sans-serif;
      font-size: 18px; 
      font-weight: 600; 
      color: var(--text);
      display: flex; 
      align-items: center; 
      gap: 12px;
    }
    
    .card-actions {
      display: flex; 
      gap: 10px;
    }
    
    .card-action-btn {
      width: 34px; 
      height: 34px; 
      border-radius: 50%;
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: var(--bg); 
      color: var(--muted); 
      border: 1px solid var(--border);
      cursor: pointer; 
      transition: var(--transition);
    }
    
    .card-action-btn:hover {
      background: var(--primary); 
      color: white;
      border-color: var(--primary);
    }
    
    .input-section { 
      margin-bottom: 25px; 
    }
    
    .file-upload {
      border: 2px dashed var(--border); 
      border-radius: var(--radius);
      padding: 30px; 
      text-align: center; 
      transition: var(--transition);
      margin-bottom: 20px; 
      cursor: pointer; 
      position: relative;
      background: var(--bg);
    }
    
    .file-upload:hover { 
      border-color: var(--primary);
      background: rgba(67, 97, 238, 0.05);
    }
    
    .upload-icon { 
      font-size: 42px; 
      margin-bottom: 15px; 
      color: var(--muted); 
    }
    
    .file-info {
      margin-top: 15px; 
      padding: 12px; 
      background: var(--bg);
      border-radius: var(--radius-sm); 
      font-size: 14px; 
      display: none;
      border: 1px solid var(--border);
    }
    
    .text-area {
      width: 100%; 
      min-height: 180px; 
      background: var(--bg);
      border: 1px solid var(--border); 
      border-radius: var(--radius);
      padding: 15px; 
      color: var(--text); 
      resize: vertical;
      transition: var(--transition); 
      margin-bottom: 20px;
      font-family: inherit;
    }
    
    .text-area:focus { 
      outline: none; 
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2); 
    }
    
    .btn {
      border: 0; 
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
      color: white; 
      padding: 14px 25px;
      border-radius: var(--radius); 
      cursor: pointer; 
      transition: var(--transition);
      display: inline-flex; 
      align-items: center; 
      gap: 10px; 
      font-weight: 600;
      font-size: 15px; 
      box-shadow: var(--shadow);
    }
    
    .btn:hover { 
      transform: translateY(-2px); 
      box-shadow: var(--shadow-hover); 
    }
    
    .btn:disabled { 
      opacity: 0.6; 
      cursor: not-allowed; 
      transform: none !important; 
    }
    
    .btn-ghost {
      background: transparent; 
      color: var(--primary); 
      border: 1px solid var(--primary);
    }
    
    .btn-ghost:hover { 
      background: rgba(67, 97, 238, 0.1); 
    }
    
    .btn-sm {
      padding: 10px 16px; 
      font-size: 14px;
    }
    
    .options-grid {
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 20px;
      margin-bottom: 25px;
    }
    
    @media (max-width: 768px) {
      .options-grid { 
        grid-template-columns: 1fr; 
      }
    }
    
    .option-group { 
      margin-bottom: 15px; 
    }
    
    .option-label {
      display: block; 
      margin-bottom: 8px; 
      font-weight: 600;
      font-size: 14px; 
      color: var(--text);
    }
    
    .input-field {
      width: 100%; 
      padding: 14px; 
      background: var(--bg);
      border: 1px solid var(--border); 
      border-radius: var(--radius);
      color: var(--text); 
      transition: var(--transition); 
      font-family: inherit;
    }
    
    .input-field:focus { 
      outline: none; 
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2); 
    }
    
    .tabs {
      display: flex; 
      gap: 5px; 
      background: var(--bg);
      padding: 5px; 
      border-radius: var(--radius); 
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }
    
    .tab {
      padding: 12px 20px; 
      border-radius: var(--radius-sm); 
      cursor: pointer;
      transition: var(--transition); 
      font-size: 14px; 
      font-weight: 500;
      text-align: center; 
      flex: 1;
      color: var(--muted);
    }
    
    .tab.active { 
      background: var(--primary); 
      color: white; 
    }
    
    .preview-area {
      width: 100%; 
      min-height: 200px; 
      max-height: 300px; 
      background: var(--bg); 
      border: 1px solid var(--border); 
      border-radius: var(--radius); 
      padding: 15px; 
      color: var(--text); 
      resize: none; 
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      overflow-y: auto;
    }
    
    .domain-table {
      width: 100%; 
      border-collapse: collapse; 
      font-size: 14px;
    }
    
    .domain-table th, 
    .domain-table td {
      padding: 12px 10px; 
      text-align: left; 
      border-bottom: 1px solid var(--border);
    }
    
    .domain-table th { 
      color: var(--muted); 
      font-weight: 600; 
    }
    
    .domain-table tr:hover { 
      background: var(--bg); 
    }
    
    .progress-bar {
      width: 100%; 
      height: 10px; 
      background: var(--bg);
      border-radius: 999px; 
      overflow: hidden; 
      margin: 15px 0;
      border: 1px solid var(--border);
    }
    
    .progress-fill {
      height: 100%; 
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); 
      width: 0%;
      border-radius: 999px; 
      transition: width 0.5s ease;
    }
    
    .download-section {
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 15px;
      margin-top: 25px;
    }
    
    @media (max-width: 768px) {
      .download-section { 
        grid-template-columns: 1fr; 
      }
    }
    
    .notification {
      position: fixed; 
      bottom: 30px; 
      right: 30px; 
      padding: 16px 24px;
      background: var(--card); 
      border-left: 4px solid var(--primary);
      border-radius: var(--radius); 
      box-shadow: var(--shadow-hover); 
      display: flex;
      align-items: center; 
      gap: 15px; 
      transform: translateX(100%); 
      opacity: 0;
      transition: all 0.4s ease; 
      z-index: 1000; 
      max-width: 350px;
      border: 1px solid var(--border);
    }
    
    .notification.show {
      transform: translateX(0); 
      opacity: 1;
    }
    
    .notification.success { 
      border-left-color: var(--success); 
    }
    
    .notification.error { 
      border-left-color: var(--danger); 
    }
    
    .notification.warning { 
      border-left-color: var(--warning); 
    }
    
    .chart-container {
      width: 100%; 
      height: 300px; 
      margin-top: 20px;
    }
    
    /* Advanced Filter Panel */
    .filter-panel {
      background: var(--bg); 
      border-radius: var(--radius);
      padding: 20px; 
      margin-bottom: 25px; 
      border: 1px solid var(--border);
    }
    
    .filter-header {
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      margin-bottom: 15px; 
      cursor: pointer;
    }
    
    .filter-title {
      font-weight: 600; 
      display: flex; 
      align-items: center; 
      gap: 10px;
      color: var(--text);
    }
    
    .filter-content {
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 20px;
    }
    
    @media (max-width: 768px) {
      .filter-content { 
        grid-template-columns: 1fr; 
      }
    }
    
    .history-list {
      list-style: none; 
      margin-top: 15px;
    }
    
    .history-item {
      padding: 12px 15px; 
      background: var(--bg);
      border-radius: var(--radius-sm); 
      margin-bottom: 10px;
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      font-size: 14px;
      border: 1px solid var(--border);
    }
    
    .history-info {
      display: flex; 
      flex-direction: column; 
      gap: 5px;
    }
    
    .history-actions {
      display: flex; 
      gap: 8px;
    }
    
    /* Section styling */
    .section {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    .section.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(10px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    /* Responsive Design */
    @media (max-width: 1200px) {
      .sidebar { 
        width: 80px; 
        padding: 20px 10px; 
      }
      
      .logo-text, 
      .nav-links span { 
        display: none; 
      }
      
      .logo { 
        justify-content: center; 
      }
      
      .nav-links a { 
        justify-content: center; 
        padding: 15px; 
      }
    }
    
    @media (max-width: 992px) {
      body { 
        flex-direction: column; 
      }
      
      .sidebar { 
        width: 100%; 
        height: auto; 
        position: relative; 
        padding: 15px; 
        flex-direction: row; 
        align-items: center;
      }
      
      .logo { 
        margin-bottom: 0; 
        margin-right: 20px; 
        padding-bottom: 0;
        border-bottom: none;
      }
      
      .nav-links { 
        display: flex; 
        margin-top: 0; 
        gap: 10px; 
      }
      
      .nav-links li { 
        margin-bottom: 0; 
      }
      
      .sidebar-footer { 
        display: none; 
      }
      
      .main-content { 
        padding: 20px 15px; 
      }
    }
    
    @media (max-width: 768px) {
      .dashboard-grid { 
        grid-template-columns: 1fr; 
      }
      
      .app-header { 
        flex-direction: column; 
        align-items: flex-start; 
        gap: 15px; 
      }
      
      .header-actions { 
        width: 100%; 
        justify-content: space-between; 
      }
      
      .nav-links {
        overflow-x: auto;
        padding-bottom: 10px;
      }
    }
    
    .loading {
      display: inline-block; 
      width: 20px; 
      height: 20px;
      border: 3px solid rgba(67, 97, 238, 0.3); 
      border-radius: 50%;
      border-top-color: var(--primary); 
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin { 
      to { 
        transform: rotate(360deg); 
      } 
    }
    
    .tooltip {
      position: relative; 
      display: inline-block; 
      cursor: help;
      margin-left: 8px;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden; 
      width: 220px; 
      background: var(--card);
      color: var(--text); 
      text-align: center; 
      border-radius: 6px;
      padding: 10px; 
      position: absolute; 
      z-index: 1; 
      bottom: 125%;
      left: 50%; 
      transform: translateX(-50%); 
      opacity: 0;
      transition: opacity 0.3s; 
      font-size: 13px; 
      line-height: 1.5;
      box-shadow: var(--shadow); 
      border: 1px solid var(--border);
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible; 
      opacity: 1;
    }
    
    /* Custom checkbox */
    .checkbox-container {
      display: flex; 
      align-items: center; 
      gap: 10px; 
      cursor: pointer;
    }
    
    .custom-checkbox {
      width: 18px; 
      height: 18px; 
      border: 2px solid var(--border);
      border-radius: 4px; 
      display: flex; 
      align-items: center;
      justify-content: center; 
      transition: var(--transition);
      background: var(--bg);
    }
    
    input[type="checkbox"] {
      display: none;
    }
    
    input[type="checkbox"]:checked + .custom-checkbox {
      background: var(--primary); 
      border-color: var(--primary);
    }
    
    input[type="checkbox"]:checked + .custom-checkbox::after {
      content: '✓'; 
      color: white; 
      font-size: 12px;
    }
    
    /* Badge */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
    }
  </style>
</head>
<body>
  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <div class="logo">
      <div class="logo-icon">
        <i class="fas fa-envelope-open-text"></i>
      </div>
      <div class="logo-text">Email Tools<br><span>Splitter & Extractor</span></div>
    </div>
    
    <ul class="nav-links">
      <li><a href="#" class="nav-link active" data-section="dashboard"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
      <li><a href="#" class="nav-link" data-section="extraction"><i class="fas fa-code"></i> <span>Extraction</span></a></li>
      <li><a href="#" class="nav-link" data-section="history"><i class="fas fa-history"></i> <span>History</span></a></li>
      <li><a href="#" class="nav-link" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
      <li><a href="#" class="nav-link" data-section="help"><i class="fas fa-question-circle"></i> <span>Help</span></a></li>
    </ul>
    
    <div class="sidebar-footer">
      <p>v2.1.0 &copy; 2023 Email Tools</p>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Dashboard Section -->
    <section id="dashboard" class="section active">
      <div class="app-header">
        <h1 class="header-title">Dashboard</h1>
        <div class="header-actions">
          <button class="theme-toggle" id="theme">
            <i class="fas fa-moon"></i> Dark Mode
          </button>
          <div class="user-profile">
            <i class="fas fa-user"></i>
          </div>
        </div>
      </div>
      
      <!-- Stats Dashboard -->
      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="totalEmails">0</div>
            <div class="stat-label">Total Emails</div>
            <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 12% from last week</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-filter"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="uniqueEmails">0</div>
            <div class="stat-label">Unique Emails</div>
            <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 8% from last week</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-copy"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="duplicateEmails">0</div>
            <div class="stat-label">Duplicates</div>
            <div class="stat-trend trend-down"><i class="fas fa-arrow-down"></i> 3% from last week</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-ban"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="filteredEmails">0</div>
            <div class="stat-label">Filtered Out</div>
            <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 5% from last week</div>
          </div>
        </div>
      </div>
      
      <div class="content-grid">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-chart-pie"></i>
              Domain Distribution
            </h2>
          </div>
          <div class="chart-container">
            <canvas id="domainChart"></canvas>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-history"></i>
              Recent Activity
            </h2>
          </div>
          <ul class="history-list">
            <li class="history-item">
              <div class="history-info">
                <strong>Document.txt</strong>
                <span>254 emails extracted - 2 hours ago</span>
              </div>
              <div class="history-actions">
                <button class="card-action-btn"><i class="fas fa-redo"></i></button>
              </div>
            </li>
            <li class="history-item">
              <div class="history-info">
                <strong>Pasted content</strong>
                <span>89 emails extracted - 1 day ago</span>
              </div>
              <div class="history-actions">
                <button class="card-action-btn"><i class="fas fa-redo"></i></button>
              </div>
            </li>
            <li class="history-item">
              <div class="history-info">
                <strong>Website.html</strong>
                <span>512 emails extracted - 3 days ago</span>
              </div>
              <div class="history-actions">
                <button class="card-action-btn"><i class="fas fa-redo"></i></button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </section>
    
    <!-- Extraction Section -->
    <section id="extraction" class="section">
      <div class="app-header">
        <h1 class="header-title">Email Extraction</h1>
        <div class="header-actions">
          <button class="theme-toggle" id="themeExtraction">
            <i class="fas fa-moon"></i> Dark Mode
          </button>
          <div class="user-profile">
            <i class="fas fa-user"></i>
          </div>
        </div>
      </div>
      
      <div class="content-grid">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-file-import"></i>
              Input & Configuration
              <span class="badge">PRO</span>
            </h2>
            <div class="card-actions">
              <button class="card-action-btn" title="Settings"><i class="fas fa-cog"></i></button>
              <button class="card-action-btn" title="Help"><i class="fas fa-question"></i></button>
            </div>
          </div>
          
          <div class="input-section">
            <div class="file-upload" id="dropZone">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <p>Drag & drop files here</p>
              <p class="muted">or click to browse (TXT, CSV, JSON, HTML, LOG)</p>
              <input type="file" id="fileInput" accept=".txt,.csv,.log,.json,.md,.html,.doc,.docx" multiple style="display: none;">
            </div>
            
            <div class="file-info" id="fileInfo">
              <i class="fas fa-file"></i> <span id="fileName">No file selected</span>
              <span id="fileSize"></span>
            </div>
            
            <textarea class="text-area" id="pasteArea" placeholder="Paste text with emails here..."></textarea>
            
            <div style="text-align: center;">
              <button class="btn" id="parseBtn">
                <i class="fas fa-search"></i> Extract Emails
              </button>
              <button class="btn btn-ghost" id="clearBtn">
                <i class="fas fa-trash"></i> Clear
              </button>
            </div>
          </div>
          
          <!-- Advanced Filter Panel -->
          <div class="filter-panel">
            <div class="filter-header" id="filterToggle">
              <div class="filter-title">
                <i class="fas fa-filter"></i>
                Advanced Filters
              </div>
              <i class="fas fa-chevron-down"></i>
            </div>
            
            <div class="filter-content" id="filterContent">
              <div class="option-group">
                <label class="option-label">Chunk Size</label>
                <input type="number" class="input-field" id="chunkSize" value="2000" min="1">
              </div>
              
              <div class="option-group">
                <label class="option-label">Include Domains</label>
                <input type="text" class="input-field" id="includeDomains" placeholder="gmail.com, outlook.com">
              </div>
              
              <div class="option-group">
                <label class="option-label">Exclude Domains</label>
                <input type="text" class="input-field" id="excludeDomains" placeholder="spam.com, test.org">
              </div>
              
              <div class="option-group">
                <label class="option-label">Options</label>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                  <label class="checkbox-container">
                    <input type="checkbox" id="preserveOrder" checked>
                    <span class="custom-checkbox"></span>
                    Preserve Order
                  </label>
                  <label class="checkbox-container">
                    <input type="checkbox" id="groupByDomain">
                    <span class="custom-checkbox"></span>
                    Group by Domain
                  </label>
                  <label class="checkbox-container">
                    <input type="checkbox" id="validateEmails" checked>
                    <span class="custom-checkbox"></span>
                    Validate Email Format
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-chart-bar"></i>
              Results & Export
            </h2>
            <div class="card-actions">
              <button class="card-action-btn" title="Refresh"><i class="fas fa-sync-alt"></i></button>
            </div>
          </div>
          
          <div class="tabs">
            <div class="tab active" data-tab="preview">Preview</div>
            <div class="tab" data-tab="domains">Domains</div>
            <div class="tab" data-tab="progress">Progress</div>
          </div>
          
          <div id="previewTab" class="tab-content active">
            <textarea class="preview-area" id="previewArea" readonly>Extracted emails will appear here...</textarea>
          </div>
          
          <div id="domainsTab" class="tab-content" style="display: none;">
            <table class="domain-table">
              <thead>
                <tr>
                  <th>Domain</th>
                  <th>Count</th>
                  <th>Percentage</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="domainTableBody">
                <tr><td colspan="4" style="text-align: center;">No domain data available</td></tr>
              </tbody>
            </table>
          </div>
          
          <div id="progressTab" class="tab-content" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText" style="text-align: center; color: var(--muted);">Waiting for operation...</p>
          </div>
          
          <div class="download-section">
            <button class="btn" id="downloadZip">
              <i class="fas fa-file-archive"></i> Download ZIP
            </button>
            <button class="btn btn-ghost" id="downloadCSV">
              <i class="fas fa-file-csv"></i> Export CSV
            </button>
            <button class="btn btn-ghost" id="downloadExcel">
              <i class="fas fa-file-excel"></i> Export Excel
            </button>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Other sections would go here (History, Settings, Help) -->
    <section id="history" class="section">
      <div class="app-header">
        <h1 class="header-title">Extraction History</h1>
      </div>
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-history"></i>
            Past Extractions
          </h2>
        </div>
        <p style="padding: 20px; text-align: center; color: var(--muted);">
          Your extraction history will appear here. This feature is coming soon!
        </p>
      </div>
    </section>
    
    <section id="settings" class="section">
      <div class="app-header">
        <h1 class="header-title">Settings</h1>
      </div>
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-cog"></i>
            Application Settings
          </h2>
        </div>
        <p style="padding: 20px; text-align: center; color: var(--muted);">
          Customize your experience. This feature is coming soon!
        </p>
      </div>
    </section>
    
    <section id="help" class="section">
      <div class="app-header">
        <h1 class="header-title">Help & Support</h1>
      </div>
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-question-circle"></i>
            Frequently Asked Questions
          </h2>
        </div>
        <p style="padding: 20px; text-align: center; color: var(--muted);">
          Find answers to common questions. This feature is coming soon!
        </p>
      </div>
    </section>
  </main>

  <div class="notification" id="notification">
    <i class="fas fa-info-circle"></i>
    <div id="notificationText"></div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // DOM Elements
    const themeToggle = document.getElementById('theme');
    const themeToggleExtraction = document.getElementById('themeExtraction');
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const pasteArea = document.getElementById('pasteArea');
    const parseBtn = document.getElementById('parseBtn');
    const clearBtn = document.getElementById('clearBtn');
    const chunkSize = document.getElementById('chunkSize');
    const includeDomains = document.getElementById('includeDomains');
    const excludeDomains = document.getElementById('excludeDomains');
    const preserveOrder = document.getElementById('preserveOrder');
    const groupByDomain = document.getElementById('groupByDomain');
    const validateEmails = document.getElementById('validateEmails');
    const totalEmails = document.getElementById('totalEmails');
    const uniqueEmails = document.getElementById('uniqueEmails');
    const duplicateEmails = document.getElementById('duplicateEmails');
    const filteredEmails = document.getElementById('filteredEmails');
    const previewArea = document.getElementById('previewArea');
    const domainTableBody = document.getElementById('domainTableBody');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const downloadZip = document.getElementById('downloadZip');
    const downloadCSV = document.getElementById('downloadCSV');
    const downloadExcel = document.getElementById('downloadExcel');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const filterToggle = document.getElementById('filterToggle');
    const filterContent = document.getElementById('filterContent');
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.section');

    // State
    let extractedEmails = [];
    let uniqueEmailList = [];
    let filteredEmailList = [];
    let domainStats = {};
    let isDarkMode = false;
    let chart = null;

    // Constants
    const EMAIL_REGEX = /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/g;
    const VALID_EMAIL_REGEX = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;

    // Initialize
    function init() {
      setupEventListeners();
      updateDownloadButtons(false);
      showNotification('Welcome to Email Splitter and Extractor!', 'success');
      createSampleChart();
      
      // Load saved settings if any
      loadSettings();
    }

    // Set up event listeners
    function setupEventListeners() {
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      themeToggleExtraction.addEventListener('click', toggleTheme);
      
      // File handling
      dropZone.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', handleFileUpload);
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--primary)';
        dropZone.style.background = 'rgba(67, 97, 238, 0.05)';
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = '';
        dropZone.style.background = '';
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '';
        dropZone.style.background = '';
        if (e.dataTransfer.files.length > 0) {
          fileInput.files = e.dataTransfer.files;
          handleFileUpload();
        }
      });
      
      // Parse button
      parseBtn.addEventListener('click', parseEmails);
      
      // Clear button
      clearBtn.addEventListener('click', clearAll);
      
      // Download buttons
      downloadZip.addEventListener('click', downloadAsZip);
      downloadCSV.addEventListener('click', downloadAsCSV);
      downloadExcel.addEventListener('click', downloadAsExcel);
      
      // Tabs
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          switchTab(tabName);
        });
      });
      
      // Filter toggle
      filterToggle.addEventListener('click', () => {
        filterContent.style.display = filterContent.style.display === 'none' ? 'grid' : 'none';
        const icon = filterToggle.querySelector('i.fa-chevron-down');
        icon.classList.toggle('fa-chevron-down');
        icon.classList.toggle('fa-chevron-up');
      });
      
      // Save settings when changed
      const settingsInputs = [chunkSize, includeDomains, excludeDomains, preserveOrder, groupByDomain, validateEmails];
      settingsInputs.forEach(input => {
        input.addEventListener('change', saveSettings);
      });
      
      // Navigation
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const sectionId = link.getAttribute('data-section');
          switchSection(sectionId);
        });
      });
    }

    // Switch between sections
    function switchSection(sectionId) {
      // Update nav links
      navLinks.forEach(link => {
        if (link.getAttribute('data-section') === sectionId) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
      
      // Update sections
      sections.forEach(section => {
        if (section.id === sectionId) {
          section.classList.add('active');
        } else {
          section.classList.remove('active');
        }
      });
    }

    // Switch between tabs
    function switchTab(tabName) {
      // Update tab buttons
      tabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabName) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Update tab content
      tabContents.forEach(content => {
        if (content.id === `${tabName}Tab`) {
          content.style.display = 'block';
        } else {
          content.style.display = 'none';
        }
      });
      
      // If domains tab, create chart
      if (tabName === 'domains' && Object.keys(domainStats).length > 0) {
        createDomainChart();
      }
    }

    // Toggle theme
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-theme', isDarkMode);
      themeToggle.innerHTML = isDarkMode ? 
        '<i class="fas fa-sun"></i> Light Mode' : 
        '<i class="fas fa-moon"></i> Dark Mode';
      themeToggleExtraction.innerHTML = isDarkMode ? 
        '<i class="fas fa-sun"></i> Light Mode' : 
        '<i class="fas fa-moon"></i> Dark Mode';
      
      // Save theme preference
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
      
      showNotification(isDarkMode ? 'Dark mode enabled' : 'Light mode enabled');
    }

    // Handle file upload
    async function handleFileUpload() {
      if (!fileInput.files.length) return;
      
      const file = fileInput.files[0];
      const fileNameText = file.name;
      const fileSizeText = formatFileSize(file.size);
      
      // Show file info
      fileName.textContent = fileNameText;
      fileSize.textContent = fileSizeText;
      fileInfo.style.display = 'flex';
      
      showNotification(`Processing ${fileNameText}...`);
      setProgress(10, 'Reading file...');
      
      try {
        const text = await readFileAsText(file);
        setProgress(50, 'File loaded successfully');
        pasteArea.value = text;
        
        // Automatically parse if the file contains text
        if (text.trim().length > 0) {
          setTimeout(() => {
            parseEmails();
          }, 500);
        }
      } catch (error) {
        showNotification('Error reading file: ' + error.message, 'error');
        setProgress(0, 'File reading failed');
      }
    }

    // Read file as text
    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = e => reject(new Error('Could not read file'));
        reader.readAsText(file);
      });
    }

    // Format file size
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Parse emails from text
    function parseEmails() {
      const text = pasteArea.value;
      if (!text.trim()) {
        showNotification('Please paste some text or upload a file first', 'error');
        return;
      }
      
      setProgress(20, 'Extracting emails...');
      
      // Extract emails using regex
      const extracted = text.match(EMAIL_REGEX) || [];
      extractedEmails = extracted.map(email => email.toLowerCase().trim());
      
      setProgress(40, 'Processing emails...');
      
      // Remove duplicates
      uniqueEmailList = [...new Set(extractedEmails)];
      
      // Apply filters
      applyFilters();
      
      // Update stats
      updateStats();
      
      // Update preview
      updatePreview();
      
      // Update domain table
      updateDomainTable();
      
      setProgress(100, 'Extraction completed');
      showNotification(`Successfully extracted ${extractedEmails.length} emails`, 'success');
      
      // Enable download buttons
      updateDownloadButtons(true);
      
      // Switch to preview tab
      switchTab('preview');
      
      // Save to history
      saveToHistory(extractedEmails.length);
    }

    // Apply domain filters
    function applyFilters() {
      const includeText = includeDomains.value;
      const excludeText = excludeDomains.value;
      
      // Parse domain lists
      const includeList = includeText.split(',').map(d => d.trim().toLowerCase()).filter(d => d);
      const excludeList = excludeText.split(',').map(d => d.trim().toLowerCase()).filter(d => d);
      
      // Filter emails
      filteredEmailList = uniqueEmailList.filter(email => {
        const domain = email.split('@')[1];
        
        // Check include list
        if (includeList.length > 0 && !includeList.includes(domain)) {
          return false;
        }
        
        // Check exclude list
        if (excludeList.length > 0 && excludeList.includes(domain)) {
          return false;
        }
        
        // Validate email format if enabled
        if (validateEmails.checked && !VALID_EMAIL_REGEX.test(email)) {
          return false;
        }
        
        return true;
      });
      
      // Calculate domain stats
      calculateDomainStats();
    }

    // Calculate domain statistics
    function calculateDomainStats() {
      domainStats = {};
      
      for (const email of filteredEmailList) {
        const domain = email.split('@')[1];
        domainStats[domain] = (domainStats[domain] || 0) + 1;
      }
    }

    // Update statistics display
    function updateStats() {
      totalEmails.textContent = extractedEmails.length.toLocaleString();
      uniqueEmails.textContent = uniqueEmailList.length.toLocaleString();
      duplicateEmails.textContent = (extractedEmails.length - uniqueEmailList.length).toLocaleString();
      filteredEmails.textContent = (uniqueEmailList.length - filteredEmailList.length).toLocaleString();
    }

    // Update preview area
    function updatePreview() {
      if (filteredEmailList.length === 0) {
        previewArea.value = 'No emails to display';
        return;
      }
      
      // Show first 20 emails
      const previewEmails = filteredEmailList.slice(0, 20);
      previewArea.value = previewEmails.join('\n');
      
      if (filteredEmailList.length > 20) {
        previewArea.value += `\n\n...and ${filteredEmailList.length - 20} more emails`;
      }
    }

    // Update domain table
    function updateDomainTable() {
      if (Object.keys(domainStats).length === 0) {
        domainTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No domain data available</td></tr>';
        return;
      }
      
      // Sort domains by count (descending)
      const sortedDomains = Object.entries(domainStats)
        .sort((a, b) => b[1] - a[1]);
      
      let tableHTML = '';
      const totalEmailsCount = filteredEmailList.length;
      
      for (const [domain, count] of sortedDomains) {
        const percentage = ((count / totalEmailsCount) * 100).toFixed(1);
        tableHTML += `
          <tr>
            <td>${domain}</td>
            <td>${count.toLocaleString()}</td>
            <td>${percentage}%</td>
            <td>
              <button class="card-action-btn" onclick="filterDomain('${domain}')" title="Filter by domain">
                <i class="fas fa-filter"></i>
              </button>
            </td>
          </tr>
        `;
      }
      
      domainTableBody.innerHTML = tableHTML;
    }

    // Create sample chart for dashboard
    function createSampleChart() {
      const ctx = document.getElementById('domainChart');
      
      // Destroy previous chart if exists
      if (chart) {
        chart.destroy();
      }
      
      // Create new chart with sample data
      chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['gmail.com', 'yahoo.com', 'outlook.com', 'hotmail.com', 'others'],
          datasets: [{
            data: [45, 20, 15, 10, 10],
            backgroundColor: [
              '#4361ee', '#4895ef', '#4cc9f0', '#3a0ca3', '#adb5bd'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: 'var(--text)'
              }
            }
          }
        }
      });
    }

    // Create domain chart
    function createDomainChart() {
      const ctx = document.createElement('canvas');
      ctx.id = 'domainChartResults';
      
      // Remove existing chart container if any
      const existingChart = document.getElementById('domainChartContainerResults');
      if (existingChart) {
        existingChart.remove();
      }
      
      const chartContainer = document.createElement('div');
      chartContainer.id = 'domainChartContainerResults';
      chartContainer.className = 'chart-container';
      
      const domainsTab = document.getElementById('domainsTab');
      domainsTab.appendChild(chartContainer);
      chartContainer.appendChild(ctx);
      
      // Prepare data for chart
      const sortedDomains = Object.entries(domainStats)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10); // Top 10 domains
      
      const labels = sortedDomains.map(item => item[0]);
      const data = sortedDomains.map(item => item[1]);
      
      // Destroy previous chart if exists
      if (chart) {
        chart.destroy();
      }
      
      // Create new chart
      chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: [
              '#4361ee', '#4895ef', '#4cc9f0', '#3a0ca3', '#7209b7',
              '#f72585', '#f9c74f', '#90be6d', '#f94144', '#577590'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: 'var(--text)'
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const percentage = ((context.raw / filteredEmailList.length) * 100).toFixed(1);
                  return `${context.label}: ${context.raw} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Filter by domain
    function filterDomain(domain) {
      includeDomains.value = domain;
      parseEmails();
      showNotification(`Filtered emails to ${domain} domain`);
    }

    // Set progress
    function setProgress(percent, text) {
      progressFill.style.width = `${percent}%`;
      progressText.textContent = text;
    }

    // Show notification
    function showNotification(message, type = 'info') {
      notificationText.textContent = message;
      notification.className = 'notification';
      if (type !== 'info') notification.classList.add(type);
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Update download buttons state
    function updateDownloadButtons(enabled) {
      downloadZip.disabled = !enabled;
      downloadCSV.disabled = !enabled;
      downloadExcel.disabled = !enabled;
    }

    // Download as ZIP
    async function downloadAsZip() {
      if (filteredEmailList.length === 0) {
        showNotification('No emails to download', 'error');
        return;
      }
      
      setProgress(10, 'Preparing ZIP archive...');
      
      try {
        const zip = new JSZip();
        const chunkSizeValue = parseInt(chunkSize.value) || 2000;
        
        if (groupByDomain.checked) {
          // Group by domain
          const emailsByDomain = {};
          
          for (const email of filteredEmailList) {
            const domain = email.split('@')[1];
            if (!emailsByDomain[domain]) {
              emailsByDomain[domain] = [];
            }
            emailsByDomain[domain].push(email);
          }
          
          let processed = 0;
          const domains = Object.keys(emailsByDomain);
          
          for (const domain of domains) {
            const domainFolder = zip.folder(domain);
            const emails = emailsByDomain[domain];
            const chunks = chunkArray(emails, chunkSizeValue);
            
            for (let i = 0; i < chunks.length; i++) {
              const chunk = chunks[i];
              const content = chunk.join('\n');
              domainFolder.file(`part_${i + 1}.txt`, content);
            }
            
            processed++;
            setProgress(10 + (processed / domains.length) * 70, `Processing ${domain}...`);
            await delay(10); // Yield to UI
          }
        } else {
          // Simple chunking
          const chunks = chunkArray(filteredEmailList, chunkSizeValue);
          
          for (let i = 0; i < chunks.length; i++) {
            const chunk = chunks[i];
            const content = chunk.join('\n');
            zip.file(`emails_part_${i + 1}.txt`, content);
            
            setProgress(10 + (i / chunks.length) * 70, `Processing chunk ${i + 1}/${chunks.length}...`);
            await delay(10); // Yield to UI
          }
        }
        
        setProgress(80, 'Generating ZIP file...');
        
        // Generate ZIP file
        const blob = await zip.generateAsync({ type: 'blob' }, metadata => {
          setProgress(80 + (metadata.percent / 100) * 20, `Compressing: ${Math.round(metadata.percent)}%`);
        });
        
        setProgress(100, 'Downloading...');
        
        // Download the file
        saveAs(blob, `emails_${new Date().toISOString().slice(0, 10)}.zip`);
        
        showNotification('ZIP file downloaded successfully', 'success');
        
        // Reset progress after a delay
        setTimeout(() => setProgress(0, 'Ready'), 2000);
      } catch (error) {
        console.error('ZIP creation error:', error);
        showNotification('Error creating ZIP file: ' + error.message, 'error');
        setProgress(0, 'ZIP creation failed');
      }
    }

    // Download as CSV
    function downloadAsCSV() {
      if (filteredEmailList.length === 0) {
        showNotification('No emails to export', 'error');
        return;
      }
      
      setProgress(50, 'Generating CSV...');
      
      try {
        // Create CSV content
        let csvContent = 'Email,Domain\n';
        for (const email of filteredEmailList) {
          const domain = email.split('@')[1];
          csvContent += `"${email}","${domain}"\n`;
        }
        
        // Create blob and download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        saveAs(blob, `emails_${new Date().toISOString().slice(0, 10)}.csv`);
        
        setProgress(100, 'CSV downloaded');
        showNotification('CSV file downloaded successfully', 'success');
        
        setTimeout(() => setProgress(0, 'Ready'), 2000);
      } catch (error) {
        showNotification('Error creating CSV file: ' + error.message, 'error');
        setProgress(0, 'CSV creation failed');
      }
    }

    // Download as Excel
    function downloadAsExcel() {
      if (filteredEmailList.length === 0) {
        showNotification('No emails to export', 'error');
        return;
      }
      
      setProgress(50, 'Generating Excel file...');
      
      try {
        // Prepare data
        const data = [['Email', 'Domain']];
        for (const email of filteredEmailList) {
          const domain = email.split('@')[1];
          data.push([email, domain]);
        }
        
        // Create worksheet and workbook
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Emails');
        
        // Generate file and download
        XLSX.writeFile(wb, `emails_${new Date().toISOString().slice(0, 10)}.xlsx`);
        
        setProgress(100, 'Excel file downloaded');
        showNotification('Excel file downloaded successfully', 'success');
        
        setTimeout(() => setProgress(0, 'Ready'), 2000);
      } catch (error) {
        showNotification('Error creating Excel file: ' + error.message, 'error');
        setProgress(0, 'Excel creation failed');
      }
    }

    // Clear all inputs and results
    function clearAll() {
      pasteArea.value = '';
      fileInput.value = '';
      fileInfo.style.display = 'none';
      extractedEmails = [];
      uniqueEmailList = [];
      filteredEmailList = [];
      domainStats = {};
      
      updateStats();
      previewArea.value = 'Extracted emails will appear here...';
      domainTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No domain data available</td></tr>';
      
      if (chart) {
        chart.destroy();
        chart = null;
      }
      
      updateDownloadButtons(false);
      setProgress(0, 'Ready');
      
      showNotification('All inputs and results cleared');
    }

    // Save settings to localStorage
    function saveSettings() {
      const settings = {
        chunkSize: chunkSize.value,
        includeDomains: includeDomains.value,
        excludeDomains: excludeDomains.value,
        preserveOrder: preserveOrder.checked,
        groupByDomain: groupByDomain.checked,
        validateEmails: validateEmails.checked
      };
      
      localStorage.setItem('emailSplitterSettings', JSON.stringify(settings));
      showNotification('Settings saved');
    }

    // Load settings from localStorage
    function loadSettings() {
      const savedSettings = localStorage.getItem('emailSplitterSettings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        
        chunkSize.value = settings.chunkSize || 2000;
        includeDomains.value = settings.includeDomains || '';
        excludeDomains.value = settings.excludeDomains || '';
        preserveOrder.checked = settings.preserveOrder !== false; // Default true
        groupByDomain.checked = settings.groupByDomain || false;
        validateEmails.checked = settings.validateEmails !== false; // Default true
        
        showNotification('Settings loaded');
      }
      
      // Load theme preference
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        toggleTheme(); // Switch to dark mode if saved
      }
    }

    // Save to history
    function saveToHistory(emailCount) {
      const history = JSON.parse(localStorage.getItem('emailSplitterHistory') || '[]');
      
      history.unshift({
        date: new Date().toISOString(),
        source: fileInput.files[0] ? fileInput.files[0].name : 'Pasted content',
        emailCount: emailCount
      });
      
      // Keep only last 10 history items
      if (history.length > 10) {
        history.pop();
      }
      
      localStorage.setItem('emailSplitterHistory', JSON.stringify(history));
    }

    // Utility function to chunk array
    function chunkArray(array, size) {
      const result = [];
      for (let i = 0; i < array.length; i += size) {
        result.push(array.slice(i, i + size));
      }
      return result;
    }

    // Utility function to delay execution
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Initialize the application
    init();
  </script>
</body>
</html>
